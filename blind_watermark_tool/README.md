# 图片暗水印工具

基于 [blind_watermark](https://github.com/guofei9987/blind_watermark) 开源项目实现的ComfyUI暗水印节点。

## 功能特点

- **隐形水印**: 嵌入的水印肉眼不可见，不影响图片质量
- **抗攻击性**: 对旋转、裁剪、缩放、噪声等攻击具有较强的鲁棒性
- **双重保护**: 支持图片密码和水印密码双重保护
- **多种水印**: 支持文本水印和图片水印两种模式

## 安装依赖

在使用前需要安装相关依赖：

```bash
pip install blind-watermark
```

或者安装完整依赖：

```bash
pip install -r blind_watermark_tool/requirements.txt
```

## 节点说明

### 1. 图片暗水印嵌入 (BlindWatermarkEmbed)

**输入参数：**
- `image`: 要嵌入水印的原始图片
- `watermark_text`: 水印文本内容（默认："DaiMao Tools"）
- `password_img`: 图片密码（1-999999）
- `password_wm`: 水印密码（1-999999）
- `watermark_image`: 可选的水印图片

**输出：**
- `嵌入水印的图片`: 包含隐形水印的图片
- `水印信息`: JSON格式的水印信息，用于提取时参考

### 2. 图片暗水印提取 (BlindWatermarkExtract)

**输入参数：**
- `image`: 包含水印的图片
- `password_img`: 图片密码（必须与嵌入时一致）
- `password_wm`: 水印密码（必须与嵌入时一致）
- `watermark_type`: 水印类型（text/image）
- `watermark_length`: 文本水印长度（可选）
- `watermark_width`: 图片水印宽度（可选）
- `watermark_height`: 图片水印高度（可选）
- `watermark_info`: 嵌入时生成的水印信息（可选，用于自动设置参数）

**输出：**
- `提取的水印文本`: 提取出的文本内容
- `提取的水印图片`: 提取出的图片内容

## 使用方法

### 文本水印示例

1. **嵌入文本水印：**
   - 连接图片到 `图片暗水印嵌入` 节点
   - 设置水印文本，如："版权所有 © 2024"
   - 设置密码（记住这些密码）
   - 执行后获得带水印的图片

2. **提取文本水印：**
   - 连接带水印的图片到 `图片暗水印提取` 节点
   - 输入相同的密码
   - 选择水印类型为 "text"
   - 执行后获得提取的文本

### 图片水印示例

1. **嵌入图片水印：**
   - 连接原图到 `图片暗水印嵌入` 节点
   - 连接水印图片到 `watermark_image` 输入
   - 设置密码
   - 执行后获得带水印的图片和水印信息

2. **提取图片水印：**
   - 连接带水印的图片到 `图片暗水印提取` 节点
   - 输入相同的密码
   - 选择水印类型为 "image"
   - 可以将嵌入时的水印信息连接到 `watermark_info` 输入以自动设置参数
   - 执行后获得提取的图片

## 重要提示

1. **密码保护**: 提取水印时必须使用与嵌入时相同的密码
2. **参数匹配**: 提取图片水印时需要知道原始水印的尺寸
3. **质量影响**: 水印嵌入会对图片质量产生轻微影响，但肉眼难以察觉
4. **抗攻击性**: 该算法对常见的图片处理操作具有一定的抗性，但不是绝对的

## 技术原理

本工具基于 DWT-DCT-SVD 算法实现：
- **DWT**: 离散小波变换，用于频域分析
- **DCT**: 离散余弦变换，用于频率域处理
- **SVD**: 奇异值分解，用于数据嵌入

这种组合算法在保持图片视觉质量的同时，提供了良好的水印隐蔽性和鲁棒性。

## 许可证

本项目基于 MIT 许可证开源，核心算法来自 [blind_watermark](https://github.com/guofei9987/blind_watermark) 项目。 